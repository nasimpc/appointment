<html>

<body id="a">
    <h1>Form</h1>
    <form onsubmit="saveToStorage(event)">
        <label> Category</label>
        <input id="category" type="text" name="category" required />
        <label> Expense</label>
        <input id="expense" type="number" name="expense" required />
        <button> Submit </button><br>

    </form>
    <p id="b"></p>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.0/axios.min.js"></script>
    <script>

        var body = document.getElementById('a');
        body.addEventListener('click', editItem);


        async function saveToStorage(e) {
            e.preventDefault();
            const category = event.target.category.value;
            const expense = event.target.expense.value;

            const obj = {
                category: category,
                expense: expense,
            }
            const expenseDetails = axios.post("http://localhost:3000/expense/add-expense", obj)
            let res = await expenseDetails;
            showNewExpenseOnScreen(res.data.newExpenseDetail)
        }
        window.addEventListener("DOMContentLoaded", async () => {
            const getExpenses = axios.get("http://localhost:3000/expense/get-expense")

            let res = await getExpenses;
            for (var i = 0; res.data.allExpenses.length; i++) {

                showNewExpenseOnScreen(res.data.allExpenses[i])
            }

        })

        //show details on screen
        function showNewExpenseOnScreen(obj, ID = '1qazx234rfvrrf') {
            console.log(obj.id, obj, 'hi');

            if (obj.id) {
                ID = obj.id;
            }
            var newText = document.createTextNode(obj['category'] + ' ' + obj['expense'] + ' ');
            //var newText = document.createTextNode('nasim');
            // Add text to div
            var a = document.querySelector('#a');
            var b = document.querySelector('#b');
            linebreak = document.createElement("br");
            var div = document.createElement('div');
            div.id = ID;
            div.appendChild(newText);

            //delete btn
            var deleteBtn = document.createElement('button');
            var editBtn = document.createElement('button');

            deleteBtn.className = 'btn btn-sm float-right delete';
            editBtn.className = 'btn btn-sm float-right';

            deleteBtn.appendChild(document.createTextNode('X'));
            editBtn.appendChild(document.createTextNode('Edit'));

            div.appendChild(editBtn);
            div.appendChild(deleteBtn);
            div.appendChild(linebreak);

            a.insertBefore(div, b);
        }
        // Remove item
        function editItem(e) {

            if (e.target.classList.contains('delete')) {

                if (confirm('Are You Sure?')) {
                    var div = e.target.parentElement;
                    body.removeChild(div);

                    var id = div.id;
                    axios.delete(`http://localhost:3000/expense/delete-expense/${id}`);
                }
            }
            else if (e.target.classList.contains('btn-sm')) {

                var div = e.target.parentElement;
                var id = div.id;
                var words = div.firstChild.wholeText.split(" ");

                body.removeChild(div);
                var category = document.getElementById('category');
                category.value = words[0];
                var expense = document.getElementById('expense');
                expense.value = words[1];
                axios.delete(`http://localhost:3000/expense/delete-expense/${id}`);

            }
        }

    </script>
</body>

</html>